---
layout: post
title: nginx 模块(8)  #标题
tagline: 基于Nginx的中间架构
category: nginx      #分类
author: wali    #作者
tag: nginx     #标签
ghurl:        #github url
ghurl_zip:    #github zip下载

post_nav: ["1.http_stub_status_module配置","2.random_index_module","3.http_sub_module"]
---

小菜简单介绍nginx模块，模块太多，就不一一介绍。

nginx模块在编译的时候就作为选项被添加进去，查看添加哪些模块

	nginx -V
	
# 1.http_stub_status_module配置

```nginx
syntax: stub_status;
default: -
contentx: server,location
```

下面小菜配置到自己walidream.com的域名下，展示一下做什么用处的。根据语法知道配置在server,和location下，小菜就配置location下面

	cd /etc/nginx/conf.d/
	
	vim server1.conf

将这段代码添加到 `location /`下面
	
```nginx
location /mystatus {
	stub_status;
}   
```	

然后在浏览器上输入walidream.com/mystatus

![ssl](http://pi6ah6koe.bkt.clouddn.com/nginx/nginx_n1.jpg)

```nginx
Active connections: 2  #连接数
server accepts handled requests
 94 94 86  #总握手次数  总连接数  总请求数
Reading: 0 Writing: 1 Waiting: 1  #读的数   写的数  等待的数
```

# 2.random_index_module

语法

```nginx
syntax: random_index on|off;
default: random_index off;
context: location
```

随机的获取目录下面后缀为`.html`，进入配置

```nginx
location / {
	root /var/share/nginx/html/server;
	random_index on;
}
```

在/var/share/nginx/html/server目录下新建1.html,2.html,3.html内容分别为

```html
<!--这个是1.html内容 -->
<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body style="background:red;">
	
</body>
</html>

<!--这个是2.html内容 -->

<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body style="background:blue;">
	
</body>
</html>

<!--这个是3.html内容 -->

<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body style="background:blank;">
	
</body>
</html>
```

然后在浏览器输入 walidream.com,多按几次f5刷新看看:

# 3.http_sub_module

作用是替换返回html的内容

语法

```nginx
syntax: sub_filter string replacement;  
default: -
contentx: http,server,location
```

### 1.sub_filter_last_modified用来校验服务端的html内容是否有更新，主要用于缓存

```nginx
syntax: sub_filter_last_modified on|off;
default: sub_filter_last_modified off;
context: http,server,location
```

### 2.sub_filter_once 只匹配第一个还是匹配所有

```nginx
syntax: sub_filter_once on|off;
default: sub_filter_once on;
contentx: http,server,location;
```

# 4.连接限制

```nginx
syntax: limit_conn_zone key zone=name:size;
default: -;
contentx: http;
```

```nginx
syntax: limit_conn number;
default: -;
contentx: http,server,location;
```

# 5.请求限制

```nginx
syntax: limit_req_zone key zone=name:size rate=rate;
default: -;
contentx: http;
```

```nginx
syntax: limit_req zone=name [burst=number][nodelay]
default: -;
contentx: http,server,location;
```












