I"˜t<p>Scrapyå¸¦æœ‰è‡ªå·±çš„æ•°æ®æå–æœºåˆ¶ï¼Œç§°ä¸ºé€‰æ‹©å™¨ã€‚scrapyæœ‰<code class="language-plaintext highlighter-rouge">xpath</code>å’Œ<code class="language-plaintext highlighter-rouge">css</code>ä¸¤ç§é€‰æ‹©å™¨ã€‚XPath æ˜¯ä¸€ç§åœ¨XMLæ–‡æ¡£ä¸­é€‰æ‹©èŠ‚ç‚¹çš„è¯­è¨€ï¼Œä¹Ÿå¯ä»¥ä¸HTMLä¸€èµ·ä½¿ç”¨ã€‚ CSS æ˜¯ç”¨äºå°†æ ·å¼åº”ç”¨äºHTMLæ–‡æ¡£çš„è¯­è¨€ã€‚å®ƒå®šä¹‰é€‰æ‹©å™¨ï¼Œå°†è¿™äº›æ ·å¼ä¸ç‰¹å®šçš„HTMLå…ƒç´ ç›¸å…³è”ã€‚</p>

<h1 id="1æ„é€ é€‰æ‹©å™¨">1.æ„é€ é€‰æ‹©å™¨</h1>

<p>å“åº”å¯¹è±¡<code class="language-plaintext highlighter-rouge">(response)</code>å…¬å¼€ <code class="language-plaintext highlighter-rouge">Selector</code> å®ä¾‹å¯¹ <code class="language-plaintext highlighter-rouge">.selector</code> å±æ€§</p>

<p>åœ¨responseä¸­è¿˜åŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼š <code class="language-plaintext highlighter-rouge">response.xpath()</code> å’Œ <code class="language-plaintext highlighter-rouge">response.css()</code></p>

<p>ä½¿ç”¨Selectoræ„é€ ç›´æ¥ä»æ–‡æœ¬æ„é€ </p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">scrapy.selector</span> <span class="kn">import</span> <span class="n">Selector</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">body</span> <span class="o">=</span> <span class="s">'&lt;html&gt;&lt;body&gt;&lt;span&gt;good&lt;/span&gt;&lt;/body&gt;&lt;/html&gt;'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Selector</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">body</span><span class="p">).</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//span/text()'</span><span class="p">).</span><span class="n">get</span><span class="p">()</span>
<span class="s">'good'</span>
</code></pre></div></div>

<h1 id="2ä½¿ç”¨é€‰æ‹©å™¨">2.ä½¿ç”¨é€‰æ‹©å™¨</h1>

<p>ä¸ºäº†è§£é‡Šå¦‚ä½•ä½¿ç”¨é€‰æ‹©å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ Scrapy shell æ¥æµ‹è¯•</p>

<p>ä¸ºäº†å®Œæ•´èµ·è§ï¼Œä¸‹é¢æ˜¯å®Œæ•´çš„HTMLä»£ç </p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;base</span> <span class="na">href=</span><span class="s">'http://example.com/'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;title&gt;</span>Example website<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'images'</span><span class="nt">&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'image1.html'</span><span class="nt">&gt;</span>Name: My image 1 <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;img</span> <span class="na">src=</span><span class="s">'image1_thumb.jpg'</span> <span class="nt">/&gt;&lt;/a&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'image2.html'</span><span class="nt">&gt;</span>Name: My image 2 <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;img</span> <span class="na">src=</span><span class="s">'image2_thumb.jpg'</span> <span class="nt">/&gt;&lt;/a&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'image3.html'</span><span class="nt">&gt;</span>Name: My image 3 <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;img</span> <span class="na">src=</span><span class="s">'image3_thumb.jpg'</span> <span class="nt">/&gt;&lt;/a&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'image4.html'</span><span class="nt">&gt;</span>Name: My image 4 <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;img</span> <span class="na">src=</span><span class="s">'image4_thumb.jpg'</span> <span class="nt">/&gt;&lt;/a&gt;</span>
   <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'image5.html'</span><span class="nt">&gt;</span>Name: My image 5 <span class="nt">&lt;br</span> <span class="nt">/&gt;&lt;img</span> <span class="na">src=</span><span class="s">'image5_thumb.jpg'</span> <span class="nt">/&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>  
</code></pre></div></div>

<p>æ‰“å¼€è™šæ‹Ÿç¯å¢ƒï¼Œæ‰§è¡Œ</p>

<pre><code class="language-txt">scrapy shell https://docs.scrapy.org/en/latest/_static/selectors-sample1.html
</code></pre>

<h1 id="3æå–æ–‡æœ¬æ•°æ®">3.æå–æ–‡æœ¬æ•°æ®</h1>

<table>
  <thead>
    <tr>
      <th>æ–¹æ³•</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>.get()</td>
      <td>å§‹ç»ˆè¿”å›å•ä¸ªç»“æœï¼›å¦‚æœæœ‰å¤šä¸ªåŒ¹é…é¡¹ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹çš„å†…å®¹ï¼›å¦‚æœæ²¡æœ‰åŒ¹é…é¡¹ï¼Œåˆ™ä¸è¿”å›ä»»ä½•åŒ¹é…é¡¹</td>
    </tr>
    <tr>
      <td>.getall()</td>
      <td>è¿”å›åŒ…å«æ‰€æœ‰ç»“æœçš„åˆ—è¡¨</td>
    </tr>
  </tbody>
</table>

<p>å¦‚æœæ‚¨æ˜¯Scrapyçš„é•¿æœŸç”¨æˆ·ï¼Œåˆ™å¯èƒ½ç†Ÿæ‚‰<code class="language-plaintext highlighter-rouge">.extract()</code>å’Œ<code class="language-plaintext highlighter-rouge">.extract_first()</code>é€‰æ‹©å™¨æ–¹æ³•. è®¸å¤šåšå®¢æ–‡ç« å’Œæ•™ç¨‹ä¹Ÿæ­£åœ¨ä½¿ç”¨å®ƒä»¬. Scrapyä»æ”¯æŒè¿™äº›æ–¹æ³•ï¼Œ æ²¡æœ‰è®¡åˆ’å¼ƒç”¨å®ƒä»¬.</p>

<p>ä½†æ˜¯ï¼Œç°åœ¨ä½¿ç”¨<code class="language-plaintext highlighter-rouge">.get()</code>å’Œ<code class="language-plaintext highlighter-rouge">.getall()</code>æ–¹æ³•ç¼–å†™Scrapyç”¨æ³•æ–‡æ¡£. æˆ‘ä»¬è®¤ä¸ºè¿™äº›æ–°æ–¹æ³•å¯ä»¥ä½¿ä»£ç æ›´ç®€æ´æ˜“è¯».</p>

<p>ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™äº›æ–¹æ³•å¦‚ä½•ç›¸äº’æ˜ å°„:</p>

<p>1.<code class="language-plaintext highlighter-rouge">SelectorList.get()</code>ä¸<code class="language-plaintext highlighter-rouge">SelectorList.extract_first()</code>ç›¸åŒï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">).</span><span class="n">get</span><span class="p">()</span>
<span class="s">'image1.html'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">).</span><span class="n">extract_first</span><span class="p">()</span>
<span class="s">'image1.html'</span>
</code></pre></div></div>

<p>2.<code class="language-plaintext highlighter-rouge">SelectorList.getall()</code>ä¸<code class="language-plaintext highlighter-rouge">SelectorList.extract()</code>ç›¸åŒï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">).</span><span class="n">getall</span><span class="p">()</span>
<span class="p">[</span><span class="s">'image1.html'</span><span class="p">,</span> <span class="s">'image2.html'</span><span class="p">,</span> <span class="s">'image3.html'</span><span class="p">,</span> <span class="s">'image4.html'</span><span class="p">,</span> <span class="s">'image5.html'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">).</span><span class="n">extract</span><span class="p">()</span>
<span class="p">[</span><span class="s">'image1.html'</span><span class="p">,</span> <span class="s">'image2.html'</span><span class="p">,</span> <span class="s">'image3.html'</span><span class="p">,</span> <span class="s">'image4.html'</span><span class="p">,</span> <span class="s">'image5.html'</span><span class="p">]</span>
</code></pre></div></div>

<p>3.<code class="language-plaintext highlighter-rouge">Selector.get()</code>ä¸<code class="language-plaintext highlighter-rouge">Selector.extract()</code>ç›¸åŒ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">get</span><span class="p">()</span>
<span class="s">'image1.html'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">extract</span><span class="p">()</span>
<span class="s">'image1.html'</span>
</code></pre></div></div>

<p>4.ä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œè¿˜æœ‰<code class="language-plaintext highlighter-rouge">Selector.getall() </code>ï¼Œå®ƒè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'a::attr(href)'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">getall</span><span class="p">()</span>
<span class="p">[</span><span class="s">'image1.html'</span><span class="p">]</span>
</code></pre></div></div>

<h1 id="4cssé€‰æ‹©å™¨">4.cssé€‰æ‹©å™¨</h1>

<table>
  <thead>
    <tr>
      <th>cssé€‰æ‹©å™¨</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>css(â€˜title::textâ€™).get()</td>
      <td>æå–<title>æ ‡ç­¾çš„æ–‡æœ¬èŠ‚ç‚¹</title></td>
    </tr>
    <tr>
      <td>css(â€˜*::textâ€™).getall()</td>
      <td>é€‰æ‹©å½“å‰é€‰æ‹©å™¨ä¸Šä¸‹æ–‡çš„æ‰€æœ‰å­ä»£æ–‡æœ¬èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>css(â€˜foo::textâ€™).get()</td>
      <td>è·å–<foo>æ ‡ç­¾çš„æ–‡æœ¬èŠ‚ç‚¹</foo></td>
    </tr>
    <tr>
      <td>css(â€˜foo::textâ€™).get(default=â€™â€™)</td>
      <td>è·å–<foo>æ ‡ç­¾çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œå¦‚æœæ²¡æœ‰è¿”å› ''</foo></td>
    </tr>
    <tr>
      <td>css(â€˜a::attr(href)â€™).getall()</td>
      <td>è·å–å…¨éƒ¨æ ‡ç­¾çš„hrefå±æ€§</td>
    </tr>
  </tbody>
</table>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'title::text'</span><span class="p">).</span><span class="n">get</span><span class="p">()</span>
<span class="s">'Example website'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'#images *::text'</span><span class="p">).</span><span class="n">getall</span><span class="p">()</span>
<span class="p">[</span><span class="s">'</span><span class="se">\n</span><span class="s">   '</span><span class="p">,</span>
 <span class="s">'Name: My image 1 '</span><span class="p">,</span>
 <span class="s">'</span><span class="se">\n</span><span class="s">   '</span><span class="p">,</span>
 <span class="s">'Name: My image 2 '</span><span class="p">,</span>
 <span class="s">'</span><span class="se">\n</span><span class="s">   '</span><span class="p">,</span>
 <span class="s">'Name: My image 3 '</span><span class="p">,</span>
 <span class="s">'</span><span class="se">\n</span><span class="s">   '</span><span class="p">,</span>
 <span class="s">'Name: My image 4 '</span><span class="p">,</span>
 <span class="s">'</span><span class="se">\n</span><span class="s">   '</span><span class="p">,</span>
 <span class="s">'Name: My image 5 '</span><span class="p">,</span>
 <span class="s">'</span><span class="se">\n</span><span class="s">  '</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">img</span><span class="p">.</span><span class="n">attrib</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'img'</span><span class="p">)]</span>
<span class="p">[</span><span class="s">'image1_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image2_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image3_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image4_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image5_thumb.jpg'</span><span class="p">]</span>
 
 
<span class="c1"># åµŒå¥—ä½¿ç”¨
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'img'</span><span class="p">).</span><span class="n">xpath</span><span class="p">(</span><span class="s">'@src'</span><span class="p">).</span><span class="n">getall</span><span class="p">()</span>
<span class="p">[</span><span class="s">'image1_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image2_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image3_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image4_thumb.jpg'</span><span class="p">,</span>
 <span class="s">'image5_thumb.jpg'</span><span class="p">]</span>

<span class="c1">#.attrib ä¹Ÿå¯ä»¥ç›´æ¥åœ¨selectorlistä¸Šä½¿ç”¨ï¼›å®ƒè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ çš„å±æ€§ï¼š
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">css</span><span class="p">(</span><span class="s">'img'</span><span class="p">).</span><span class="n">attrib</span><span class="p">[</span><span class="s">'src'</span><span class="p">]</span>
<span class="s">'image1_thumb.jpg'</span>
</code></pre></div></div>

<h1 id="5xpathé€‰æ‹©å™¨">5.xpathé€‰æ‹©å™¨</h1>

<p>xpath ä½¿ç”¨è·¯å¾„è¡¨è¾¾å¼åœ¨xmlå’Œhtmlä¸­è¿›è¡Œå¯¼èˆª</p>

<h4 id="é€‰å–èŠ‚ç‚¹">é€‰å–èŠ‚ç‚¹</h4>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>nodename</td>
      <td>é€‰å–æ­¤èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>/</td>
      <td>ä»æ ¹èŠ‚ç‚¹é€‰å–</td>
    </tr>
    <tr>
      <td>//</td>
      <td>é€‰å–åŒ¹é…æ‰€æœ‰çš„å…ƒç´ ï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬çš„ä½ç½®</td>
    </tr>
    <tr>
      <td>.</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>..</td>
      <td>é€‰å–å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td>@</td>
      <td>é€‰å–å±æ€§</td>
    </tr>
  </tbody>
</table>

<h4 id="è°“è¯­">è°“è¯­</h4>

<p>è°“è¯­ç”¨æ¥æŸ¥æ‰¾æŸä¸ªç‰¹å®šçš„èŠ‚ç‚¹æˆ–è€…åŒ…å«æŸä¸ªæŒ‡å®šçš„å€¼çš„èŠ‚ç‚¹ã€‚è°“è¯­è¢«åµŒåœ¨æ–¹æ‹¬å·ä¸­<code class="language-plaintext highlighter-rouge">[]</code></p>

<table>
  <thead>
    <tr>
      <th>è¡¨è¾¾å¼</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>//body/div[1]</td>
      <td>é€‰å–bodyå…ƒç´ ä¸‹çš„ç¬¬ä¸€ä¸ªdivå…ƒç´ </td>
    </tr>
    <tr>
      <td>//body/div[last()]</td>
      <td>é€‰å–bodyå…ƒç´ çš„æœ€åä¸€ä¸ªdivå…ƒç´ </td>
    </tr>
    <tr>
      <td>//body/div[last() - 1]</td>
      <td>é€‰å–bodyå…ƒç´ çš„å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ </td>
    </tr>
    <tr>
      <td>//body/div[position() &lt; 3]</td>
      <td>é€‰å–bodyå…ƒç´ ä¸‹ å‰ä¸¤ä¸ªdivå…ƒç´ </td>
    </tr>
    <tr>
      <td>//title[@lang]</td>
      <td>é€‰å–æ‰€æœ‰æ‹¥æœ‰åä¸ºlangçš„å±æ€§çš„titleå…ƒç´ </td>
    </tr>
    <tr>
      <td>//title[@lang=â€™engâ€™]</td>
      <td>é€‰å–æ‰€æœ‰æ‹¥æœ‰åä¸ºlangçš„å±æ€§çš„titleå…ƒç´ </td>
    </tr>
    <tr>
      <td>//body/div[price&gt;35.00]</td>
      <td>é€‰å–æ‰€æœ‰bodyå…ƒç´ ä¸‹çš„divå…ƒç´ ï¼Œå¹¶ä¸”priceå…ƒç´ çš„å€¼å¤§äº 35.00</td>
    </tr>
    <tr>
      <td>//body/div[contains(@class, â€˜bbbbâ€™)]</td>
      <td>åŒ¹é…bodyä¸‹ divä¸­classå±æ€§åŒ…å«â€™bbbbâ€™</td>
    </tr>
  </tbody>
</table>

<h4 id="é€šé…ç¬¦">é€šé…ç¬¦</h4>

<table>
  <thead>
    <tr>
      <th>é€šé…ç¬¦</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>*</td>
      <td>åŒ¹é…ä»»ä½•å…ƒç´ </td>
    </tr>
    <tr>
      <td>@*</td>
      <td>åŒ¹é…ä»»ä½•å±æ€§çš„å…ƒç´ </td>
    </tr>
    <tr>
      <td>node()</td>
      <td>åŒ¹é…ä»»ä½•ç±»å‹çš„å…ƒç´ </td>
    </tr>
  </tbody>
</table>

<h4 id="è¿ç®—ç¬¦">è¿ç®—ç¬¦</h4>

<table>
  <thead>
    <tr>
      <th>è¿ç®—ç¬¦</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>|</td>
      <td>æˆ–</td>
    </tr>
  </tbody>
</table>

<h4 id="xpathæ–¹æ³•">xpathæ–¹æ³•</h4>

<table>
  <thead>
    <tr>
      <th>æ–¹æ³•</th>
      <th>æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>text()</td>
      <td>æå–å…ƒç´ æ–‡æœ¬èŠ‚ç‚¹</td>
    </tr>
  </tbody>
</table>

<h1 id="6xpathè¡¨è¾¾å¼ä¸­çš„å˜é‡">6.xpathè¡¨è¾¾å¼ä¸­çš„å˜é‡</h1>
<p>xpathå…è®¸æ‚¨å¼•ç”¨xpathè¡¨è¾¾å¼ä¸­çš„å˜é‡ï¼Œä½¿ç”¨ <code class="language-plaintext highlighter-rouge">$somevariable</code> è¯­æ³•ã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ ¹æ®å…ƒç´ çš„â€œidâ€å±æ€§å€¼åŒ¹é…å…ƒç´ çš„ç¤ºä¾‹ï¼Œä¸éœ€è¦å¯¹å…¶è¿›è¡Œç¡¬ç¼–ç ï¼ˆå‰é¢å·²æ˜¾ç¤ºï¼‰</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># `$val` used in the expression, a `val` argument needs to be passed
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@id=$val]/a/text()'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="s">'images'</span><span class="p">).</span><span class="n">get</span><span class="p">()</span>
<span class="s">'Name: My image 1 '</span>
</code></pre></div></div>

<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªç¤ºä¾‹ï¼Œç”¨äºæŸ¥æ‰¾ &lt;div&gt; åŒ…å«äº”ä¸ªçš„æ ‡ç­¾ <a> å­©å­ä»¬ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬ä¼ é€’ä»·å€¼ 5 ä½œä¸ºæ•´æ•°ï¼‰</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[count(a)=$cnt]/@id'</span><span class="p">,</span> <span class="n">cnt</span><span class="o">=</span><span class="mi">5</span><span class="p">).</span><span class="n">get</span><span class="p">()</span>
<span class="s">'images'</span>
</code></pre></div></div>

<h1 id="7é€‰æ‹©å™¨ä¸æ­£åˆ™ä¸€èµ·ä½¿ç”¨">7.é€‰æ‹©å™¨ä¸æ­£åˆ™ä¸€èµ·ä½¿ç”¨</h1>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">response</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[contains(@href, "image")]/text()'</span><span class="p">).</span><span class="n">re</span><span class="p">(</span><span class="sa">r</span><span class="s">'Name:\s*(.*)'</span><span class="p">)</span>
<span class="p">[</span><span class="s">'My image 1'</span><span class="p">,</span>
 <span class="s">'My image 2'</span><span class="p">,</span>
 <span class="s">'My image 3'</span><span class="p">,</span>
 <span class="s">'My image 4'</span><span class="p">,</span>
 <span class="s">'My image 5'</span><span class="p">]</span>
</code></pre></div></div>

<h1 id="8selector-objects">8.Selector Objects</h1>

<h4 id="classscrapyselectorselectorresponsenone-textnone-typenone-rootnone-kwargs">classscrapy.selector.Selector(response=None, text=None, type=None, root=None, **kwargs)</h4>

<p><code class="language-plaintext highlighter-rouge">Selector</code>å®ä¾‹æ˜¯å¯¹é€‰æ‹©å…¶å†…å®¹æŸäº›éƒ¨åˆ†çš„å“åº”çš„åŒ…è£….</p>

<p><code class="language-plaintext highlighter-rouge">response</code>æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">HtmlResponse</code>æˆ–<code class="language-plaintext highlighter-rouge">XmlResponse</code>å¯¹è±¡ï¼Œå°†ç”¨äºé€‰æ‹©å’Œæå–æ•°æ®.</p>

<p><code class="language-plaintext highlighter-rouge">text</code>æ˜¯è®¾ç½®ç¼–ç çš„å˜é‡</p>

<p><code class="language-plaintext highlighter-rouge">tpye</code>å®šä¹‰é€‰æ‹©å™¨ç±»å‹ï¼Œå¯ä»¥æ˜¯<code class="language-plaintext highlighter-rouge">html</code>ï¼Œ <code class="language-plaintext highlighter-rouge">xml</code>æˆ–<code class="language-plaintext highlighter-rouge">None</code> ï¼ˆé»˜è®¤ï¼‰</p>

<p>å¦‚æœ<code class="language-plaintext highlighter-rouge">type</code>ä¸º<code class="language-plaintext highlighter-rouge">None</code> ï¼Œåˆ™é€‰æ‹©å™¨ä¼šæ ¹æ®responseç±»å‹è‡ªåŠ¨é€‰æ‹©æœ€ä½³ç±»å‹ï¼ˆè¯·å‚è§ä¸‹æ–‡ï¼‰ï¼Œå¦‚æœä¸textä¸€èµ·ä½¿ç”¨ï¼Œåˆ™é»˜è®¤ä¸ºâ€htmlâ€ .</p>

<p>å¦‚æœ<code class="language-plaintext highlighter-rouge">type</code>ä¸º<code class="language-plaintext highlighter-rouge">None</code>ä¸”ä¼ é€’äº†<code class="language-plaintext highlighter-rouge">response</code> ï¼Œåˆ™ä»å“åº”ç±»å‹æ¨æ–­å‡ºé€‰æ‹©å™¨ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">html</code> è¿”å› <code class="language-plaintext highlighter-rouge">HtmlResponse</code>ç±»å‹</li>
  <li><code class="language-plaintext highlighter-rouge">xml</code> è¿”å› <code class="language-plaintext highlighter-rouge">XmlResponse</code>ç±»å‹</li>
  <li><code class="language-plaintext highlighter-rouge">html</code> ä»£è¡¨å…¶ä»–</li>
</ul>

<p>å¦‚æœtypeè¢«è®¾ç½®ï¼Œåˆ™é€‰æ‹©ç±»å‹å°†è¢«è¿«å¹¶ä¸”ä¸ä¼šå‘ç”Ÿæ£€æµ‹</p>

<h4 id="xpathquery-namespacesnone-kwargs">xpath(query, namespaces=None, **kwargs)</h4>

<blockquote>
  <p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ­¤æ–¹æ³•å¯ä»¥ç§°ä¸ºresponse.xpath()</p>
</blockquote>

<p>æŸ¥æ‰¾ä¸xpath queryåŒ¹é…çš„èŠ‚ç‚¹ï¼Œå¹¶ä»¥æ‰€æœ‰å…ƒç´ å±•å¹³çš„SelectorListå®ä¾‹çš„å½¢å¼è¿”å›ç»“æœ. åˆ—è¡¨å…ƒç´ ä¹Ÿå®ç°Selectoræ¥å£.</p>

<p><code class="language-plaintext highlighter-rouge">query</code>æ˜¯ä¸€ä¸ªåŒ…å«è¦åº”ç”¨çš„XPATHæŸ¥è¯¢çš„å­—ç¬¦ä¸².</p>

<p><code class="language-plaintext highlighter-rouge">namespaces</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„<code class="language-plaintext highlighter-rouge">prefix: namespace-uri</code>æ˜ å°„ï¼ˆdictï¼‰ï¼Œç”¨äºå‘é‚£äº›åœ¨<code class="language-plaintext highlighter-rouge">register_namespace(prefix, uri)</code>æä¾›é™„åŠ å‰ç¼€. ä¸<code class="language-plaintext highlighter-rouge">register_namespace()</code>ç›¸åï¼Œè¿™äº›å‰ç¼€ä¸ä¼šä¿å­˜ä¾›ä»¥åè°ƒç”¨.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">selector</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[href=$url]'</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">"http://www.example.com"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="cssquery">css(query)</h4>

<blockquote>
  <p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæ­¤æ–¹æ³•å¯ä»¥ç§°ä¸ºresponse.css()</p>
</blockquote>

<p>åº”ç”¨ç»™å®šçš„CSSé€‰æ‹©å™¨å¹¶è¿”å›<code class="language-plaintext highlighter-rouge">SelectorList</code>å®ä¾‹.</p>

<p><code class="language-plaintext highlighter-rouge">query</code>æ˜¯ä¸€ä¸ªåŒ…å«è¦åº”ç”¨çš„CSSé€‰æ‹©å™¨çš„å­—ç¬¦ä¸².</p>

<h4 id="get">get()</h4>

<p>åºåˆ—åŒ–å¹¶ä»¥å•ä¸ªunicodeå­—ç¬¦ä¸²è¿”å›åŒ¹é…çš„èŠ‚ç‚¹. ç¼–ç å†…å®¹çš„ç™¾åˆ†æ¯”æœªå¼•ç”¨.</p>

<h4 id="attrib">attrib</h4>

<p>è¿”å›åŸºç¡€å…ƒç´ çš„å±æ€§å­—å…¸.</p>

<h4 id="reregex-replace_entitiestrue">re(regex, replace_entities=True)</h4>

<p>åº”ç”¨ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶è¿”å›å…·æœ‰åŒ¹é…é¡¹çš„unicodeå­—ç¬¦ä¸²åˆ—è¡¨.</p>

<p><code class="language-plaintext highlighter-rouge">regex</code>å¯ä»¥æ˜¯å·²ç¼–è¯‘çš„æ­£regexä¹Ÿå¯ä»¥æ˜¯å°†ä½¿ç”¨<code class="language-plaintext highlighter-rouge">re.compile(regex)</code>ç¼–è¯‘ä¸ºæ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸².</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—ç¬¦å®ä½“å¼•ç”¨ç”±å…¶å¯¹åº”çš„å­—ç¬¦æ›¿æ¢ï¼ˆ <code class="language-plaintext highlighter-rouge">&amp;amp;</code>å’Œ<code class="language-plaintext highlighter-rouge">&amp;lt;</code>é™¤å¤–ï¼‰. ä¼ é€’<code class="language-plaintext highlighter-rouge">replace_entities</code>ä¸º<code class="language-plaintext highlighter-rouge">False</code>å…³é—­è¿™äº›æ›¿æ¢.</p>

<h4 id="re_firstregex-defaultnone-replace_entitiestrue">re_first(regex, default=None, replace_entities=True)</h4>

<p>åº”ç”¨ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼å¹¶è¿”å›åŒ¹é…çš„ç¬¬ä¸€ä¸ªunicodeå­—ç¬¦ä¸². å¦‚æœä¸åŒ¹é…ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ï¼ˆå¦‚æœæœªæä¾›å‚æ•°ï¼Œåˆ™è¿”å›<code class="language-plaintext highlighter-rouge">None</code> ï¼‰.</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—ç¬¦å®ä½“å¼•ç”¨ç”±å…¶å¯¹åº”çš„å­—ç¬¦æ›¿æ¢ï¼ˆ <code class="language-plaintext highlighter-rouge">&amp;amp;</code>å’Œ<code class="language-plaintext highlighter-rouge">&amp;lt;</code>é™¤å¤–ï¼‰. ä¼ é€’<code class="language-plaintext highlighter-rouge">replace_entities</code>ä¸º<code class="language-plaintext highlighter-rouge">False</code>å…³é—­è¿™äº›æ›¿æ¢.</p>

<h4 id="register_namespaceprefix-uri">register_namespace(prefix, uri)</h4>

<p>æ³¨å†Œè¦åœ¨æ­¤Selectorä½¿ç”¨çš„ç»™å®šåç§°ç©ºé—´. å¦‚æœä¸æ³¨å†Œåç§°ç©ºé—´ï¼Œåˆ™æ— æ³•ä»éæ ‡å‡†åç§°ç©ºé—´é€‰æ‹©æˆ–æå–æ•°æ®</p>

<h4 id="remove_namespaces">remove_namespaces()</h4>

<p>åˆ é™¤æ‰€æœ‰åç§°ç©ºé—´ï¼Œå…è®¸ä½¿ç”¨æ— åç§°ç©ºé—´çš„xpathéå†æ–‡æ¡£</p>

<h4 id="bool"><strong>bool</strong>()</h4>

<p>å¦‚æœé€‰æ‹©äº†ä»»ä½•å®é™…å†…å®¹ï¼Œåˆ™è¿”å›Trueå¦åˆ™è¿”å›False . æ¢å¥è¯è¯´ï¼Œ Selectorçš„å¸ƒå°”å€¼ç”±å…¶é€‰æ‹©çš„å†…å®¹ç»™å‡º.</p>

<h4 id="getall">getall()</h4>

<p>åºåˆ—åŒ–å¹¶ä»¥1å…ƒç´ çš„unicodeå­—ç¬¦ä¸²åˆ—è¡¨è¿”å›åŒ¹é…çš„èŠ‚ç‚¹</p>

<h1 id="9selectorlist-objects">9.SelectorList objects</h1>

<h4 id="classscrapyselectorselectorlist">classscrapy.selector.SelectorList</h4>

<p><code class="language-plaintext highlighter-rouge">SelectorList</code>ç±»æ˜¯å†…ç½®listç±»çš„å­ç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›å…¶ä»–æ–¹æ³•.</p>

<h4 id="xpathxpath-namespacesnone-kwargs">xpath(xpath, namespaces=None, **kwargs)</h4>

<p>å¯¹è¯¥åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨<code class="language-plaintext highlighter-rouge">.xpath()</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶ç»“æœå±•å¹³ä¸ºå¦ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">SelectorList</code> .</p>

<p><code class="language-plaintext highlighter-rouge">query</code>ä¸<code class="language-plaintext highlighter-rouge">Selector.xpath()</code>å‚æ•°ç›¸åŒ</p>

<p><code class="language-plaintext highlighter-rouge">namespaces</code>æ˜¯ä¸€ä¸ªå¯é€‰çš„<code class="language-plaintext highlighter-rouge">prefix: namespace-uri</code>æ˜ å°„ï¼ˆdictï¼‰ï¼Œç”¨äºå‘é‚£äº›åœ¨<code class="language-plaintext highlighter-rouge">register_namespace(prefix, uri)</code>æä¾›é™„åŠ å‰ç¼€. ä¸<code class="language-plaintext highlighter-rouge">register_namespace()</code>ç›¸åï¼Œè¿™äº›å‰ç¼€ä¸ä¼šä¿å­˜ä¾›ä»¥åè°ƒç”¨.</p>

<p>ä»»ä½•å…¶ä»–å‘½åå‚æ•°éƒ½å¯ä»¥ç”¨äºåœ¨XPathè¡¨è¾¾å¼ä¸­ä¼ é€’XPathå˜é‡çš„å€¼ï¼Œä¾‹å¦‚ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">selector</span><span class="p">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//a[href=$url]'</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">"http://www.example.com"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="cssquery-1">css(query)</h4>

<p>å¯¹è¯¥åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨<code class="language-plaintext highlighter-rouge">.css()</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶ç»“æœå±•å¹³ä¸ºå¦ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">SelectorList</code> .</p>

<h4 id="getall-1">getall()</h4>

<p>è°ƒç”¨æ­¤åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ çš„<code class="language-plaintext highlighter-rouge">.get()</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶ç»“æœå±•å¹³ï¼Œä½œä¸ºUnicodeå­—ç¬¦ä¸²åˆ—è¡¨è¿”å›</p>

<h4 id="getdefaultnone">get(default=None)</h4>

<p>è¿”å›æ­¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„<code class="language-plaintext highlighter-rouge">.get()</code>ç»“æœ. å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›é»˜è®¤å€¼</p>

<h4 id="reregex-replace_entitiestrue-1">re(regex, replace_entities=True)</h4>

<p>å¯¹è¯¥åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ è°ƒç”¨<code class="language-plaintext highlighter-rouge">.re()</code>æ–¹æ³•ï¼Œå¹¶å°†å…¶ç»“æœå±•å¹³ï¼Œä½œä¸ºUnicodeå­—ç¬¦ä¸²åˆ—è¡¨è¿”å›.</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—ç¬¦å®ä½“å¼•ç”¨å°†æ›¿æ¢ä¸ºå…¶å¯¹åº”çš„å­—ç¬¦ï¼ˆ <code class="language-plaintext highlighter-rouge">&amp;amp;</code>å’Œ<code class="language-plaintext highlighter-rouge">&amp;lt;</code>é™¤å¤–.å¦‚æœ<code class="language-plaintext highlighter-rouge">False</code>ä¼ é€’<code class="language-plaintext highlighter-rouge">replace_entities</code>å…³é—­è¿™äº›æ›¿æ¢.</p>

<h4 id="re_firstregex-defaultnone-replace_entitiestrue-1">re_first(regex, default=None, replace_entities=True)</h4>

<p>å¯¹è¯¥åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ è°ƒç”¨<code class="language-plaintext highlighter-rouge">.re()</code>æ–¹æ³•ï¼Œå¹¶ä»¥Unicodeå­—ç¬¦ä¸²è¿”å›ç»“æœ. å¦‚æœåˆ—è¡¨ä¸ºç©ºæˆ–æ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…ä»»ä½•å†…å®¹ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ï¼ˆå¦‚æœæœªæä¾›å‚æ•°ï¼Œåˆ™è¿”å›None ï¼‰.</p>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå­—ç¬¦å®ä½“å¼•ç”¨å°†æ›¿æ¢ä¸ºå…¶å¯¹åº”çš„å­—ç¬¦ï¼ˆ<code class="language-plaintext highlighter-rouge">&amp;amp;</code>å’Œ<code class="language-plaintext highlighter-rouge">&amp;lt;</code>é™¤å¤–.å¦‚æœ<code class="language-plaintext highlighter-rouge">False</code>ä¼ é€’<code class="language-plaintext highlighter-rouge">replace_entities</code>å…³é—­è¿™äº›æ›¿æ¢.</p>

<h4 id="attrib-1">attrib</h4>

<p>è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ çš„å±æ€§å­—å…¸. å¦‚æœåˆ—è¡¨ä¸ºç©ºï¼Œåˆ™è¿”å›ç©ºdict</p>

:ET