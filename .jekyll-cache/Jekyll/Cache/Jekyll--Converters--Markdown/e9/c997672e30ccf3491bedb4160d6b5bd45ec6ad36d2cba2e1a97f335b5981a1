I"J<p>在初学scrapy时，按照官方的文档写了一个爬虫片段，发现怎么都会不会进入<code class="language-plaintext highlighter-rouge">parse()</code>方法。下面是spider代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>

<span class="k">class</span> <span class="nc">XcfSpider</span><span class="p">(</span><span class="n">scrapy</span><span class="p">.</span><span class="n">Spider</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">'xcf'</span>
    <span class="n">allowed_domains</span> <span class="o">=</span> <span class="p">[</span><span class="s">'xiachufang.com'</span><span class="p">]</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">'https://www.xiachufang.com/category/731/'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></div>

<h1 id="1403问题">1.403问题</h1>

<p>在<code class="language-plaintext highlighter-rouge">parse()</code>方法内部打一个断点，重新运行爬虫。</p>

<p><img src="http://walidream.com:9999/blogImage/python/python_36.png" alt="ssl" /></p>

<p>看到输出信息中有一个403的状态码，正常的请求中<code class="language-plaintext highlighter-rouge">response</code>状态码是200。在生成项目时，有一个设置项目<code class="language-plaintext highlighter-rouge">settings.py</code>文件。能够找到这段代码</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Crawl responsibly by identifying yourself (and your website) on the user-agent
# USER_AGENT = 'xiachufang (+http://www.yourdomain.com)
</span></code></pre></div></div>

<p>在默认情况下，用户代理<code class="language-plaintext highlighter-rouge">USER_AGENT</code>被设置成这样。</p>

<h4 id="解决方案">解决方案</h4>

<p>打开<code class="language-plaintext highlighter-rouge">settings.py</code>文件，将<code class="language-plaintext highlighter-rouge">USER_AGENG</code>修改为</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">USER_AGENT</span> <span class="o">=</span> <span class="s">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.87 Safari/537.36'</span>
</code></pre></div></div>

<p>然后重启项目</p>

<p><img src="http://walidream.com:9999/blogImage/python/python_37.png" alt="ssl" /></p>

<p>发现进入<code class="language-plaintext highlighter-rouge">parse()</code>方法，代码在断点处停下来</p>

<h1 id="2总结">2.总结</h1>

<p>对于有些网站，可能会检查<code class="language-plaintext highlighter-rouge">USER_AGENt</code>，恰好小菜就碰到了。将上面的url修改<code class="language-plaintext highlighter-rouge">https://baidu.com</code>就可以进入断点。推测百度可能没有做限制。</p>

<p>总结：</p>
<ul>
  <li>在调试时，要多看控制台的信息输出</li>
  <li>spider只有在<code class="language-plaintext highlighter-rouge">response</code>响应状态为<code class="language-plaintext highlighter-rouge">200</code>时才会进入<code class="language-plaintext highlighter-rouge">parse()</code>方法</li>
</ul>

:ET