I"-¡<blockquote>
  <p>è£å‰ªå®Œåè¯·å‚è€ƒ<code class="language-plaintext highlighter-rouge">javascrip/å›¾ç‰‡ä¸Šä¼ </code> ä¼ é€é—¨<a href="http://waliblog.com/javascript/2018/01/29/upload.html" title="http://waliblog.com/javascript/2018/01/29/upload.html">â€œhttp://waliblog.com/javascript/2018/01/29/upload.htmlâ€</a></p>
</blockquote>

<p>è¿™ç¯‡canvaså¤´åƒè£å‰ªï¼Œæ²¡æœ‰ç”¨jqå»å†™demoä¸»è¦æ˜¯å› ä¸ºæ“ä½œdomå¤ªéº»çƒ¦ï¼Œè¿™ä¸ªdemoæœ€åˆæ˜¯ç”¨angularå†™çš„(å·¥ä½œéœ€è¦)ï¼Œä¸ªäººè§‰å¾—ç”¨vueæ›´æ–¹ä¾¿ï¼å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚æŠŠè§¦å‘çš„äº‹ä»¶æ¢ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p>

<p>åŸæœ¬å†™è¿™ä¸ªdemoæƒ³æœªå¤§å®¶å°è£…æˆä¸€ä¸ªjqæ’ä»¶ï¼Œä½†åæ¥ç”±äºæ—¶é—´é—®é¢˜å°±æ²¡æœ‰åšäº†ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±ç©ç©ã€‚å°èœæŠŠdemoæ”¾åœ¨ä¸ªäººgithubä¸Šï¼Œæƒ³ä¸‹è½½çš„ç‚¹å‡»é¡µé¢ä¸ŠæŒ‰é’®ã€‚åˆ«å¿˜äº†åœ¨githubä¸Šç»™ä¸ªæ˜Ÿå“¦ï¼</p>

<blockquote>
  <p>å¤‡ç”¨æ¼”ç¤ºåœ°å€ <a href="http://walidream.com/example/js/portraitNailor/" title="http://walidream.com/example/js/portraitNailor/" target="_blank">http://walidream.com/example/js/portraitNailor/</a></p>
</blockquote>

<script async="" src="//jsrun.net/X2gKp/embed/all/light/"></script>

<h1 id="1åˆ¤æ–­æœ¬åœ°å›¾ç‰‡å®½åº¦å’Œé«˜åº¦">1.åˆ¤æ–­æœ¬åœ°å›¾ç‰‡å®½åº¦å’Œé«˜åº¦</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">isUpImgWH(width,height,box)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">width</code> <code class="language-plaintext highlighter-rouge">height</code> <code class="language-plaintext highlighter-rouge">box</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼š1.è®©æœ¬åœ°å›¾ç‰‡ä¸å¤±çœŸå±•ç¤ºåœ¨canvasä¸­ï¼Œ2.è®©canvasåœ¨é»‘è‰²ç›’å­æ°´å¹³æˆ–å‚ç›´å±…ä¸­</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>width</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>æœ¬åœ°å›¾ç‰‡çš„å®½åº¦</td>
    </tr>
    <tr>
      <td>height</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>æœ¬åœ°å›¾ç‰‡çš„é«˜åº¦</td>
    </tr>
    <tr>
      <td>box</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>é»‘è‰²èƒŒæ™¯ç›’å­çš„å®½åº¦å’Œé«˜åº¦</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>å‚æ•°: <code class="language-plaintext highlighter-rouge">box</code></p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>width</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>é»‘è‰²èƒŒæ™¯ç›’å­çš„å®½åº¦</td>
    </tr>
    <tr>
      <td>height</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>é»‘è‰²èƒŒæ™¯ç›’å­çš„é«˜åº¦</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">isUpImgWH</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">box</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">canW</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">canH</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">offsetTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">//ç”»å¸ƒåç§»top</span>
    <span class="kd">let</span> <span class="nx">offsetLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//ç”»å¸ƒåç§»left</span>
    <span class="c1">//æœ¬åœ°å›¾ç‰‡å®½åº¦å¤§äºé«˜åº¦</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">height</span><span class="p">){</span>
        <span class="nx">canW</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
        <span class="nx">canH</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">canW</span> <span class="o">*</span> <span class="nx">height</span><span class="p">)</span><span class="o">/</span> <span class="nx">width</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">canH</span> <span class="o">&gt;</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="nx">canH</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">canH</span> <span class="o">==</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">offsetTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nx">offsetLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">canH</span> <span class="o">&lt;</span> <span class="nx">box</span><span class="p">.</span><span class="nx">width</span><span class="p">){</span>
            <span class="nx">offsetTop</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">box</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">canH</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
            <span class="nx">offsetLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="c1">//æœ¬åœ°å›¾ç‰‡é«˜åº¦å¤§äºç­‰äºå®½åº¦</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nx">canH</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
        <span class="nx">canW</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">canH</span><span class="p">)</span><span class="o">/</span><span class="nx">height</span><span class="p">);</span>
        
        <span class="k">if</span><span class="p">(</span><span class="nx">canW</span> <span class="o">&gt;</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="nx">canW</span> <span class="o">=</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">canW</span> <span class="o">==</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">){</span>
            <span class="nx">offsetTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="nx">offsetLeft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">canW</span> <span class="o">&lt;</span> <span class="nx">box</span><span class="p">.</span><span class="nx">height</span><span class="p">){</span>
            <span class="nx">offsetLeft</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">box</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">canW</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
            <span class="nx">offsetTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
	<span class="p">}</span>
	
    <span class="k">return</span> <span class="p">{</span>
        <span class="na">width</span><span class="p">:</span><span class="nx">canW</span><span class="p">,</span>
        <span class="na">height</span><span class="p">:</span><span class="nx">canH</span><span class="p">,</span>
        <span class="na">top</span><span class="p">:</span><span class="nx">offsetTop</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">px</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">left</span><span class="p">:</span><span class="nx">offsetLeft</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">px</span><span class="dl">'</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="2ç»˜åˆ¶å¤´åƒ">2.ç»˜åˆ¶å¤´åƒ</h1>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//ç»˜åˆ¶å¤´åƒ</span>
<span class="kd">function</span> <span class="nx">clipProtrait</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>  
  <span class="kd">let</span> <span class="nx">canWidth</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">canHeight</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">ctx</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">radius</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">handle</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">handle</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">handleImg</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">handleImg</span><span class="p">;</span>

  <span class="c1">//ç¢°å£æ£€æµ‹</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">radius</span><span class="p">)</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">canWidth</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">canWidth</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">radius</span><span class="p">)</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">radius</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">canHeight</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">)</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">canHeight</span> <span class="o">-</span> <span class="nx">radius</span><span class="p">;</span>
  
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canWidth</span><span class="p">,</span><span class="nx">canHeight</span><span class="p">);</span>
  <span class="nx">drawRect</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canWidth</span><span class="p">,</span><span class="nx">canHeight</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="dl">'</span><span class="s1">rgba(0,0,0,0.6)</span><span class="dl">'</span><span class="p">);</span>
    
  <span class="c1">//ç»˜åˆ¶å¤´åƒ</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="nx">radius</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">negativeImg</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canWidth</span><span class="p">,</span><span class="nx">canHeight</span><span class="p">);</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
  <span class="c1">//ç»˜åˆ¶æ‰‹æŸ„</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
  <span class="kd">let</span> <span class="nx">tmpPonit</span> <span class="o">=</span> <span class="nx">getCircle</span><span class="p">({</span><span class="na">x</span><span class="p">:</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="na">y</span><span class="p">:</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="na">r</span><span class="p">:</span><span class="nx">radius</span><span class="p">},</span><span class="mi">45</span><span class="p">);</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span><span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span><span class="nx">handle</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">handle</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">#fff</span><span class="dl">'</span><span class="p">;</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clip</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">handleImg</span><span class="p">,</span><span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">r</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span><span class="nx">tmpPonit</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">handle</span><span class="p">.</span><span class="nx">r</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">26</span><span class="p">);</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">;</span>

  <span class="k">return</span> <span class="nx">data</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="3ç»˜åˆ¶çŸ©å½¢">3.ç»˜åˆ¶çŸ©å½¢</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">drawRect(cxt,x,y,width,height,BW,BC,fillColor)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">ctx</code> <code class="language-plaintext highlighter-rouge">x</code> <code class="language-plaintext highlighter-rouge">y</code> <code class="language-plaintext highlighter-rouge">width</code> <code class="language-plaintext highlighter-rouge">height</code> <code class="language-plaintext highlighter-rouge">BW</code> <code class="language-plaintext highlighter-rouge">BC</code> <code class="language-plaintext highlighter-rouge">fillColor</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼šå°†canvasçš„åº•è‰²å¡«å……ç°è‰²</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>cxt</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>canvas 2dç»˜å›¾ç¯å¢ƒ</td>
    </tr>
    <tr>
      <td>x</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢åˆå§‹xåæ ‡</td>
    </tr>
    <tr>
      <td>y</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢åˆå§‹yåæ ‡</td>
    </tr>
    <tr>
      <td>width</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢å®½åº¦</td>
    </tr>
    <tr>
      <td>height</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢é«˜åº¦</td>
    </tr>
    <tr>
      <td>BW</td>
      <td>String</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢è¾¹æ¡†å®½åº¦</td>
    </tr>
    <tr>
      <td>BC</td>
      <td>String</td>
      <td>æ˜¯</td>
      <td>çº¿æ¡é¢œè‰²</td>
    </tr>
    <tr>
      <td>fillColor</td>
      <td>String</td>
      <td>æ˜¯</td>
      <td>çŸ©å½¢å¡«å……è‰²</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">drawRect</span><span class="p">(</span><span class="nx">cxt</span><span class="p">,</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="nx">width</span><span class="p">,</span><span class="nx">height</span><span class="p">,</span><span class="nx">BW</span><span class="p">,</span><span class="nx">BC</span><span class="p">,</span><span class="nx">fillColor</span><span class="p">){</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="nx">width</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="nx">width</span><span class="p">,</span><span class="nx">y</span><span class="o">+</span><span class="nx">height</span><span class="p">);</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="o">+</span><span class="nx">height</span><span class="p">);</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
   
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">BW</span><span class="p">;</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="nx">fillColor</span><span class="p">;</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">BC</span><span class="p">;</span>
   
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
   <span class="nx">cxt</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="4é¢„è§ˆ">4.é¢„è§ˆ</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">previewProtrait(data)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">data</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼šå°†é€‰ä¸­åŒºåŸŸçš„å›¾ç‰‡ç­‰æ¯”è£å‰ªï¼Œå¹¶è¿”å›base64</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>data</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>éœ€è¦ç”¨åˆ°çš„å‚æ•°</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">previewProtrait</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">imgW</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">negativeImg</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">imgH</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">negativeImg</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">k</span> <span class="o">=</span> <span class="nx">imgW</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">sx</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">point</span><span class="p">.</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">imgW</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">width</span><span class="p">))</span> <span class="p">;</span>
  <span class="kd">let</span> <span class="nx">sy</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">point</span><span class="p">.</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">data</span><span class="p">.</span><span class="nx">circle</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="nx">imgH</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">drawCanvas</span><span class="p">.</span><span class="nx">height</span><span class="p">));</span>
  <span class="kd">let</span> <span class="nx">sW</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">point</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">k</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">sH</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">point</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">k</span><span class="p">);</span>

  <span class="kd">let</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">canvas</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">290</span><span class="p">;</span>   <span class="c1">//è®¾ç½®è£å‰ªå®Œæˆåå›¾ç‰‡çš„å¤§å°</span>
  <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">290</span><span class="p">;</span>
  <span class="nx">drawRect</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="dl">'</span><span class="s1">#000</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">ctx</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">negativeImg</span><span class="p">,</span><span class="nx">sx</span><span class="p">,</span><span class="nx">sy</span><span class="p">,</span><span class="nx">sW</span><span class="p">,</span><span class="nx">sH</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">imgData</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">(</span><span class="dl">"</span><span class="s2">image/jpeg</span><span class="dl">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">imgData</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="5è·å–åœ†ä¸Šä»»æ„åœ°ç‚¹åæ ‡">5.è·å–åœ†ä¸Šä»»æ„åœ°ç‚¹åæ ‡</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">getCircle(circle,angle)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">circle</code> <code class="language-plaintext highlighter-rouge">angle</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼šå°†é€‰ä¸­åŒºåŸŸçš„å›¾ç‰‡ç­‰æ¯”è£å‰ªï¼Œå¹¶è¿”å›base64</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>circle</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>åœ†çš„åæ ‡x,y,r</td>
    </tr>
    <tr>
      <td>angle</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>åœ†ä¸Šè§’åº¦</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">circle</code></p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>x</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>åœ†xåæ ‡</td>
    </tr>
    <tr>
      <td>y</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>åœ†yåæ ‡</td>
    </tr>
    <tr>
      <td>r</td>
      <td>Number</td>
      <td>æ˜¯</td>
      <td>åœ†çš„åŠå¾„</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getCircle</span><span class="p">(</span><span class="nx">circle</span><span class="p">,</span><span class="nx">angle</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angle</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">);</span>
  <span class="nx">obj</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angle</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">obj</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="6ä¸¤ç‚¹é—´çš„è·ç¦»">6.ä¸¤ç‚¹é—´çš„è·ç¦»</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">getPointDistance(point1,point2)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">point1</code> <code class="language-plaintext highlighter-rouge">point2</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼šè®¡ç®—ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»ï¼Œè¿™é‡Œä¸»è¦è®¡ç®—é¼ æ ‡æ˜¯åœ¨å¤´åƒä¸Šè¿˜æ˜¯åœ¨æ‰‹æŸ„ä¸Š</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>point1</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>åæ ‡ç‚¹x,y</td>
    </tr>
    <tr>
      <td>point2</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>åæ ‡ç‚¹x,y</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getPointDistance</span><span class="p">(</span><span class="nx">point1</span><span class="p">,</span><span class="nx">point2</span><span class="p">){</span>
  <span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="p">(</span><span class="nx">point1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">point1</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">point1</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">point2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">point2</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">point2</span><span class="p">.</span><span class="nx">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">point1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">point1</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">point1</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">point2</span><span class="p">.</span><span class="nx">y</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">point2</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">point2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
  <span class="kd">let</span> <span class="nx">tmpd1</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span> <span class="nx">count</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="nx">point1</span><span class="p">.</span><span class="nx">r</span> <span class="o">&gt;</span> <span class="nx">tmpd1</span><span class="p">){</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h1 id="7å°†ä»¥base64çš„å›¾ç‰‡urlæ•°æ®è½¬æ¢ä¸ºfile">7.å°†ä»¥base64çš„å›¾ç‰‡urlæ•°æ®è½¬æ¢ä¸ºfile</h1>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">convertBase64UrlToBlob(urlData)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">urlData</code></p>
</blockquote>

<blockquote>
  <p>è¯´æ˜ï¼šå°†base64è½¬æ¢æˆfile</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>urlData</td>
      <td>String</td>
      <td>æ˜¯</td>
      <td>å›¾åƒBase64æ•°æ®</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">convertBase64UrlToBlob</span><span class="p">(</span><span class="nx">urlData</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">bytes</span><span class="o">=</span><span class="nb">window</span><span class="p">.</span><span class="nx">atob</span><span class="p">(</span><span class="nx">urlData</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>        <span class="c1">//å»æ‰urlçš„å¤´ï¼Œå¹¶è½¬æ¢ä¸ºbyte</span>
  <span class="c1">//å¤„ç†å¼‚å¸¸,å°†asciiç å°äº0çš„è½¬æ¢ä¸ºå¤§äº0</span>
  <span class="kd">var</span> <span class="nx">ab</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ArrayBuffer</span><span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">ia</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">ab</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ia</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">(</span> <span class="p">[</span><span class="nx">ab</span><span class="p">]</span> <span class="p">,</span> <span class="p">{</span><span class="na">type</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">image/png</span><span class="dl">'</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

:ET