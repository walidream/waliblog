I"ï0<p>ä»€ä¹ˆæ˜¯nginxå¹³æ»‘å‡çº§ï¼Ÿ</p>

<p>å½“å®˜æ–¹å‘å¸ƒä¸€ä¸ªæ–°çš„ç¨³å®šç‰ˆï¼Œæˆ‘ä»¬å¾ˆæœ‰å¯èƒ½éœ€è¦è¿›è¡Œç‰ˆæœ¬å‡çº§ã€‚æ–°ç‰ˆæœ¬ä¸ä»…ä¼šä¿®å¤ä¹‹å‰ç‰ˆæœ¬çš„bug,è¿˜ä¼šæ·»åŠ ä¸€äº›æ–°çš„åŠŸèƒ½(å½“ç„¶è¿˜å¾—è§†ä¸ªäººæƒ…å†µå†³å®šæ˜¯å¦å‡çº§)ã€‚æ‰€è°“çš„å¹³æ»‘å‡çº§å°±æ˜¯ä¸è¦è®©ç”¨æˆ·æ„Ÿå—åˆ°ï¼Œæˆ‘ä»¬åœ¨
å‡çº§nginx,æ—§ç‰ˆæœ¬çš„nginxè¿˜åœ¨æ­£å¸¸è¿è¡Œï¼Œå½“æˆ‘ä»¬æ›´æ–°nginxç‰ˆåï¼Œåˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸ä¼šä¸­æ–­æœåŠ¡ï¼Œè®©ç”¨æˆ·æ„Ÿå—ä¸åˆ°æœåŠ¡å¡é¡¿ã€‚</p>

<p>å¹³æ»‘å‡çº§å’Œæ·»åŠ æ¨¡å—æ˜¯ä¸€æ ·ï¼Œå‡çº§éœ€è¦ä¸‹è½½æœ€æ–°çš„nginxåŒ…ï¼Œè€Œæ·»åŠ æ¨¡å—ä¸‹è½½çš„å½“å‰ç‰ˆæœ¬çš„nginxåŒ…ã€‚å°èœè¿™ç¯‡åšå®¢æ˜¯åŸºäºä¹‹å‰<a href="/nginx/2018/11/10/nginx-3.html" title="/nginx/2018/11/10/nginx-3.html" target="_blank">nginxçš„å®‰è£… å¸è½½(3)</a>
æ¥è¿›è¡Œï¼Œæ‰€ä»¥å°ä¼™ä¼´ä»¬æœ€å¥½è¿˜æ˜¯ä¿æŒä¸€è‡´ã€‚å‡çº§æ˜¯ä¸éœ€è¦å¸è½½nginxçš„ã€‚</p>

<p>å°èœæ˜¯é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œæ“ä½œç³»ç»Ÿcentos 7</p>

<h1 id="1å®‰è£…ç¼–è¯‘æºç ç¯å¢ƒ">1.å®‰è£…ç¼–è¯‘æºç ç¯å¢ƒ</h1>

<p>ç”±äºæˆ‘ä»¬ä¸‹è½½çš„æ˜¯æºç åŒ…ï¼Œæ‰€ä»¥è¦å¯¹nginxè¿›è¡Œç¼–è¯‘ï¼Œé‚£ä¹ˆç¼–è¯‘ç¯å¢ƒå°±å¿…ä¸å¯å°‘ã€‚</p>

<p>å®‰è£…gcc</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install gcc 
</code></pre></div></div>

<p>å®‰è£…PCRE</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install pcre pcre-devel
</code></pre></div></div>

<p>å®‰è£…zlibï¼ˆzlibåº“æä¾›äº†å¼€å‘äººå‘˜çš„å‹ç¼©ç®—æ³•ï¼Œåœ¨Nginxçš„å„ç§æ¨¡å—ä¸­éœ€è¦ä½¿ç”¨gzipå‹ç¼©ã€‚å¦‚åŒå®‰è£…PCREä¸€æ ·ï¼ŒåŒæ ·éœ€è¦å®‰è£…åº“å’Œå®ƒçš„æºä»£ç ï¼šzlibå’Œzlib-develï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install zlib zlib-devel
</code></pre></div></div>

<p>å®‰è£…OpenSSLï¼ˆåœ¨Nginxä¸­ï¼Œå¦‚æœæœåŠ¡å™¨æä¾›å®‰å…¨ç½‘é¡µæ—¶åˆ™ä¼šç”¨åˆ°OpenSSLåº“ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…åº“æ–‡ä»¶å’Œå®ƒçš„å¼€å‘å®‰è£…åŒ… opensslå’Œ openssl-develï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install openssl openssl-devel
</code></pre></div></div>

<h1 id="2ä¸‹è½½nginxåŒ…">2.ä¸‹è½½nginxåŒ…</h1>

<p>ä¸‹è½½nginxåŒ…éœ€è¦å»<a href="http://nginx.org/en/download.html" title="http://nginx.org/en/download.html" target="_blank">nginx å®˜æ–¹ç½‘ç«™</a>ï¼Œå¦‚æœå‡çº§å°±æ‰¾æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„åŒ…ï¼Œå¦‚æœæ·»åŠ æ¨¡å—å°±æ‰¾å½“è‡ªå·±å½“å‰ç‰ˆæœ¬
ä¸€æ ·çš„åŒ…ã€‚æ‰¾åˆ°ä¹‹åï¼Œå¤åˆ¶ä¸‹è½½é“¾æ¥åœ°å€ï¼Œå°èœæ‰¾çš„æ˜¯å½“å‰æœ€ç¨³å®šç‰ˆæœ¬<code class="language-plaintext highlighter-rouge">https://nginx.org/download/nginx-1.14.2.tar.gz</code></p>

<h1 id="3æ·»åŠ æ¨¡å—">3.æ·»åŠ æ¨¡å—</h1>

<p>nginxè°ƒè¯•æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œæ‰€ä»¥å°èœå°±æ·»åŠ ä¸€ä¸ª<a href="https://github.com/openresty/echo-nginx-module" title="https://github.com/openresty/echo-nginx-module" target="_blank">echo-nginx-module</a>æ¨¡å—ï¼Œå®ƒçš„ç‰ˆæœ¬
<a href="https://github.com/openresty/echo-nginx-module/tags" title="https://github.com/openresty/echo-nginx-module/tags" target="_blank">æœ€æ–°ç‰ˆæœ¬</a>ï¼Œæ‰¾åˆ°è‡ªå·±è¦ä¸‹è½½åŒ…ï¼Œå¤åˆ¶ä¸‹è½½é“¾æ¥åœ°å€ï¼Œå°èœæ‰¾åˆ°æœ€æ–°åŒ…<code class="language-plaintext highlighter-rouge">https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz</code></p>

<h1 id="4ä¸‹è½½">4.ä¸‹è½½</h1>

<p>æˆ‘ä»¬å°†åˆšæ‰æ‰¾çš„åŒ…åœ°å€ä¸‹è½½ä¸‹æ¥ã€‚ä¸‹è½½åˆ°<code class="language-plaintext highlighter-rouge">/opt/download</code></p>

<pre><code class="language-txt">/opt
|-app
|-download
|-backup
</code></pre>

<p>è¿›å…¥<code class="language-plaintext highlighter-rouge">download</code>æ–‡ä»¶å¤¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /opt/download
</code></pre></div></div>

<p>ä¸‹è½½nginxåŒ…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://nginx.org/download/nginx-1.14.2.tar.gz
</code></pre></div></div>

<p>è§£å‹nginxåŒ…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -xvf nginx-1.14.2.tar.gz
</code></pre></div></div>

<p>ä¸‹è½½echo-nginx-moduleæ¨¡å—</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://github.com/openresty/echo-nginx-module/archive/v0.61.tar.gz
</code></pre></div></div>

<p>è§£å‹echo-nginx-moduleåŒ…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -xvf v0.61.tar.gz
</code></pre></div></div>

<h1 id="5ç¼–è¯‘nginxæºç ">5.ç¼–è¯‘nginxæºç </h1>

<p>ä¸ºäº†å’Œä¹‹å‰nginxç‰ˆæœ¬çš„å‚æ•°ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬å…ˆæŸ¥çœ‹ä¹‹å‰çš„nginxç¼–è¯‘å‚æ•°</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx -V
</code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<p>`
â€“prefix=/etc/nginx â€“sbin-path=/usr/sbin/nginx â€“modules-path=/usr/lib64/nginx/modules â€“conf-path=/etc/nginx/nginx.conf â€“error-log-path=/var/log/nginx/error.log â€“http-log-path=/var/log/nginx/access.log â€“pid-path=/var/run/nginx.pid â€“lock-path=/var/run/nginx.lock â€“http-client-body-temp-path=/var/cache/nginx/client_temp â€“http-proxy-temp-path=/var/cache/nginx/proxy_temp â€“http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp â€“http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp â€“http-scgi-temp-path=/var/cache/nginx/scgi_temp â€“user=nginx â€“group=nginx â€“with-compat â€“with-file-aio â€“with-threads â€“with-http_addition_module â€“with-http_auth_request_module â€“with-http_dav_module â€“with-http_flv_module â€“with-http_gunzip_module â€“with-http_gzip_static_module â€“with-http_mp4_module â€“with-http_random_index_module â€“with-http_realip_module â€“with-http_secure_link_module â€“with-http_slice_module â€“with-http_ssl_module â€“with-http_stub_status_module â€“with-http_sub_module â€“with-http_v2_module â€“with-mail â€“with-mail_ssl_module â€“with-stream â€“with-stream_realip_module â€“with-stream_ssl_module â€“with-stream_ssl_preread_module â€“with-cc-opt=â€™-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong â€“param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPICâ€™ â€“with-ld-opt=â€™-Wl,-z,relro -Wl,-z,now -pieâ€™
`</p>

<p>è¿›å…¥è§£å‹å¥½<code class="language-plaintext highlighter-rouge">nginx-1.14.2</code>æ–‡ä»¶å¤¹</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd nginx-1.14.2
</code></pre></div></div>

<p>å°†echo-nginx-moduleæ·»åŠ åˆ°ç¼–è¯‘å‚æ•°ä¸­å»ï¼Œæ·»åŠ åˆ°æœ€å</p>

<p>`
â€“prefix=/etc/nginx â€“sbin-path=/usr/sbin/nginx â€“modules-path=/usr/lib64/nginx/modules â€“conf-path=/etc/nginx/nginx.conf â€“error-log-path=/var/log/nginx/error.log â€“http-log-path=/var/log/nginx/access.log â€“pid-path=/var/run/nginx.pid â€“lock-path=/var/run/nginx.lock â€“http-client-body-temp-path=/var/cache/nginx/client_temp â€“http-proxy-temp-path=/var/cache/nginx/proxy_temp â€“http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp â€“http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp â€“http-scgi-temp-path=/var/cache/nginx/scgi_temp â€“user=nginx â€“group=nginx â€“with-compat â€“with-file-aio â€“with-threads â€“with-http_addition_module â€“with-http_auth_request_module â€“with-http_dav_module â€“with-http_flv_module â€“with-http_gunzip_module â€“with-http_gzip_static_module â€“with-http_mp4_module â€“with-http_random_index_module â€“with-http_realip_module â€“with-http_secure_link_module â€“with-http_slice_module â€“with-http_ssl_module â€“with-http_stub_status_module â€“with-http_sub_module â€“with-http_v2_module â€“with-mail â€“with-mail_ssl_module â€“with-stream â€“with-stream_realip_module â€“with-stream_ssl_module â€“with-stream_ssl_preread_module â€“with-cc-opt=â€™-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong â€“param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPICâ€™ â€“with-ld-opt=â€™-Wl,-z,relro -Wl,-z,now -pieâ€™ â€“add-module=/opt/download/echo-nginx-module-0.61
`</p>

<p>ç¼–è¯‘</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure ç¼–è¯‘å‚æ•°
</code></pre></div></div>

<p>./configure â€“prefix=/etc/nginx â€“sbin-path=/usr/sbin/nginx â€“modules-path=/usr/lib64/nginx/modules â€“conf-path=/etc/nginx/nginx.conf â€“error-log-path=/var/log/nginx/error.log â€“http-log-path=/var/log/nginx/access.log â€“pid-path=/var/run/nginx.pid â€“lock-path=/var/run/nginx.lock â€“http-client-body-temp-path=/var/cache/nginx/client_temp â€“http-proxy-temp-path=/var/cache/nginx/proxy_temp â€“http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp â€“http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp â€“http-scgi-temp-path=/var/cache/nginx/scgi_temp â€“user=nginx â€“group=nginx â€“with-compat â€“with-file-aio â€“with-threads â€“with-http_addition_module â€“with-http_auth_request_module â€“with-http_dav_module â€“with-http_flv_module â€“with-http_gunzip_module â€“with-http_gzip_static_module â€“with-http_mp4_module â€“with-http_random_index_module â€“with-http_realip_module â€“with-http_secure_link_module â€“with-http_slice_module â€“with-http_ssl_module â€“with-http_stub_status_module â€“with-http_sub_module â€“with-http_v2_module â€“with-mail â€“with-mail_ssl_module â€“with-stream â€“with-stream_realip_module â€“with-stream_ssl_module â€“with-stream_ssl_preread_module â€“with-cc-opt=â€™-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong â€“param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPICâ€™ â€“with-ld-opt=â€™-Wl,-z,relro -Wl,-z,now -pieâ€™ â€“add-module=/opt/download/echo-nginx-module-0.61</p>

<p>å®‰è£…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make &amp;&amp; make install
</code></pre></div></div>

<p>æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx -v
</code></pre></div></div>

<p>è¾“å‡º<code class="language-plaintext highlighter-rouge">nginx version: nginx/1.14.2</code>å°±ç®—å®‰è£…æˆåŠŸäº†</p>

<h1 id="6æ£€æµ‹echo-nginx-module">6.æ£€æµ‹echo-nginx-module</h1>

<p>å‰é¢å‡ æ­¥æˆ‘ä»¬å°†echo-nginx-moduleæ¨¡å—ç¼–è¯‘åˆ°nginxï¼Œä¸‹é¢æ£€æµ‹echo-nginx-module</p>

<pre><code class="language-txt">/etc/nginx/conf.d
|-echo.conf
</code></pre>

<h4 id="echoconf">echo.conf</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>       <span class="mi">9001</span><span class="p">;</span>
    <span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>


    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span> 
        <span class="kn">default_type</span> <span class="nc">text/html</span><span class="p">;</span>
        <span class="kn">echo</span> <span class="s">"&lt;h1&gt;æ¬¢è¿æ¥åˆ°ç“¦åŠ›åšå®¢&lt;/h1&gt;"</span><span class="p">;</span>
    <span class="p">}</span>   

<span class="p">}</span>
</code></pre></div></div>

<p>é‡å¯nginx</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx -s reload -c /etc/nginx/nginx.conf
</code></pre></div></div>

<p>æ£€æµ‹9001ç«¯å£ï¼Œçœ‹9001ç«¯å£æ˜¯å¦ç›‘å¬</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ss -luntp | grep nginx
</code></pre></div></div>

<p>åœ¨é¡µé¢ä¸Šè¾“å…¥<code class="language-plaintext highlighter-rouge">http://walidream.com:9001</code>ï¼Œè¾“å‡ºä¸­æ–‡å¯èƒ½ä¼šæœ‰ä¹±ç ï¼Œå‡ºç°ä¹±ç éœ€è¦å°†ç¼–ç æ”¹ä¸ºutf-8</p>

<p><img src="http://walidream.com:9999/blogImage/nginx/nginx_51.jpg" alt="ssl" /></p>

<h1 id="7echoè°ƒè¯•">7.echoè°ƒè¯•</h1>

<p>æˆ‘ä»¬æœ‰äº†echoæ¨¡å—ï¼Œåœ¨è°ƒè¯•nginxæ—¶å°±å˜å¾—å®¹æ˜“å¤šäº†ã€‚</p>

<h4 id="è¾“å‡ºå­—ç¬¦ä¸²">è¾“å‡ºå­—ç¬¦ä¸²</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">echo</span> <span class="s">"hello"</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="è¾“å…¥å˜é‡">è¾“å…¥å˜é‡</h4>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">echo</span> <span class="nv">$remote_addr</span><span class="p">;</span>
</code></pre></div></div>

:ET