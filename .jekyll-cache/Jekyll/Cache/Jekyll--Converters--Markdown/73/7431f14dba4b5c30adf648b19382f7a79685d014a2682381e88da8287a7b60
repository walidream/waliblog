I"¾1<p>è¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»ä»€ä¹ˆæ˜¯é™æ€èµ„æºã€‚nginxå°†å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰ç±»å‹å‹ç¼©æ¥å‡å°‘httpè¯·æ±‚æ•°æ¥è¾¾åˆ°ä¼˜åŒ–å‰ç«¯æ€§èƒ½ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šèƒ½å‡å°‘webæœåŠ¡å™¨çš„å‹åŠ›</p>

<h1 id="1é™æ€èµ„æºç±»å‹">1.é™æ€èµ„æºç±»å‹</h1>

<p>å‰ç«¯å‘åå°æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸¤ç§<code class="language-plaintext highlighter-rouge">é™æ€è¯·æ±‚</code>å’Œ<code class="language-plaintext highlighter-rouge">åŠ¨æ€è¯·æ±‚</code>ã€‚é™æ€è¯·æ±‚å¸¸è§åˆ—å­å®¢æˆ·ç«¯è¯·æ±‚å›¾ç‰‡ï¼Œcssï¼Œjsï¼Œhtmlæ–‡ä»¶ç­‰ã€‚åŠ¨æ€è¯·æ±‚æ˜¯éœ€è¦æœåŠ¡è¿›è¡ŒåŠ¨æ€è¿ç®—ï¼Œå°è£…æ•°æ®ç„¶ååœ¨è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>

<p><img src="http://walidream.com:9999/blogImage/nginx/nginx_7.jpg?123456" alt="ssl" /></p>

<table>
  <thead>
    <tr>
      <th>é™æ€ç±»å‹</th>
      <th>ç§ç±»</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>æµè§ˆå™¨ç«¯æ¸²æŸ“</td>
      <td>HTMLã€CSSã€JS</td>
    </tr>
    <tr>
      <td>å›¾ç‰‡</td>
      <td>JPEGã€GIFã€PNG</td>
    </tr>
    <tr>
      <td>è§†é¢‘</td>
      <td>FLVã€MPEG</td>
    </tr>
    <tr>
      <td>æ–‡ä»¶</td>
      <td>TXTã€ç­‰ä»»æ„ä¸‹è½½æ–‡ä»¶</td>
    </tr>
  </tbody>
</table>

<h1 id="2é™æ€èµ„æºæœåŠ¡åœºæ™¯cdn">2.é™æ€èµ„æºæœåŠ¡åœºæ™¯cdn</h1>

<p><img src="http://walidream.com:9999/blogImage/nginx/nginx_8.jpg?32424" alt="ssl" /></p>

<p>CDNçš„å…¨ç§°æ˜¯Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚CDNæ˜¯æ„å»ºåœ¨ç½‘ç»œä¹‹ä¸Šçš„å†…å®¹åˆ†å‘ç½‘ç»œï¼Œä¾é éƒ¨ç½²åœ¨å„åœ°çš„è¾¹ç¼˜æœåŠ¡å™¨ï¼Œé€šè¿‡ä¸­å¿ƒå¹³å°çš„è´Ÿè½½å‡è¡¡ã€å†…å®¹åˆ†å‘ã€è°ƒåº¦ç­‰åŠŸèƒ½æ¨¡å—ï¼Œä½¿ç”¨æˆ·å°±è¿‘è·å–æ‰€éœ€å†…å®¹ï¼Œé™ä½ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç”¨æˆ·è®¿é—®å“åº”é€Ÿåº¦å’Œå‘½ä¸­ç‡ã€‚</p>

<h1 id="3ngx_http_gzip_module">3.ngx_http_gzip_module</h1>

<h3 id="1gzip">1.gzip</h3>

<p>å¯ç”¨æˆ–ç¦ç”¨gzippingå“åº”ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip</span> <span class="no">on</span> <span class="s">|</span> <span class="no">off</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip</span> <span class="no">off</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location,</span> <span class="s">if</span> <span class="s">in</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="2gzip_buffers">2.gzip_buffers</h3>

<p>è®¾ç½®ç”¨äºå‹ç¼©å“åº”çš„ç¼“å†²åŒºçš„æ•°é‡å’Œå¤§å°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å†²åŒºå¤§å°ç­‰äºä¸€ä¸ªå†…å­˜é¡µé¢ã€‚è¿™æ˜¯4Kæˆ–8Kï¼Œå…·ä½“å–å†³äºå¹³å°ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_buffers</span> <span class="s">number</span> <span class="s">size</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_buffers</span> <span class="mi">32</span> <span class="mi">4k</span><span class="s">|16</span> <span class="mi">8k</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="3gzip_comp_level">3.gzip_comp_level</h3>

<p>è®¾ç½®å“åº”çš„gzipå‹ç¼©çº§åˆ«ã€‚å¯æ¥å—çš„å€¼èŒƒå›´ä¸º1åˆ°9ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_comp_level</span> <span class="s">level</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_comp_level</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="4gzip_disable">4.gzip_disable</h3>

<p>å¯¹å…·æœ‰ä¸ä»»ä½•æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„<code class="language-plaintext highlighter-rouge">User-Agent</code>æ ‡å¤´å­—æ®µçš„è¯·æ±‚ç¦ç”¨gzippingå“åº”ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_disable</span> <span class="s">regex</span> <span class="s">...</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">â€”</span>
<span class="s">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="5gzip_http_version">5.gzip_http_version</h3>

<p>è®¾ç½®å‹ç¼©å“åº”æ‰€éœ€çš„æœ€ä½HTTPè¯·æ±‚ç‰ˆæœ¬ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_http_version</span> <span class="mi">1</span><span class="s">.0</span> <span class="s">|</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="6gzip_min_length">6.gzip_min_length</h3>

<p>è®¾ç½®å°†è¢«gzipå‹ç¼©çš„å“åº”çš„æœ€å°é•¿åº¦ã€‚é•¿åº¦ä»…ç”±â€œContent-Lengthâ€å“åº”å¤´å­—æ®µç¡®å®šã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_min_length</span> <span class="s">length</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_min_length</span> <span class="mi">20</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="7gzip_proxied">7.gzip_proxied</h3>

<p>æ ¹æ®è¯·æ±‚å’Œå“åº”å¯ç”¨æˆ–ç¦ç”¨å¯¹ä»£ç†è¯·æ±‚çš„å“åº”çš„gzippingã€‚ä»£ç†è¯·æ±‚çš„äº‹å®ç”±â€œViaâ€è¯·æ±‚å¤´å­—æ®µçš„å­˜åœ¨ç¡®å®šã€‚è¯¥æŒ‡ä»¤æ¥å—å¤šä¸ªå‚æ•°ï¼š</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_proxied</span> <span class="no">off</span> <span class="s">|</span> <span class="s">expired</span> <span class="s">|</span> <span class="s">no-cache</span> <span class="s">|</span> <span class="s">no-store</span> <span class="s">|</span> <span class="s">private</span> <span class="s">|</span> <span class="s">no_last_modified</span> <span class="s">|</span> <span class="s">no_etag</span> <span class="s">|</span> <span class="s">auth</span> <span class="s">|</span> <span class="s">any</span> <span class="s">...</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_proxied</span> <span class="no">off</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<p>ã€€ã€€ã€€</p>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>off</td>
      <td>ç¦ç”¨æ‰€æœ‰ä»£ç†è¯·æ±‚çš„å‹ç¼©ï¼Œå¿½ç•¥å…¶ä»–å‚æ•°</td>
    </tr>
    <tr>
      <td>expired</td>
      <td>å¦‚æœå“åº”å¤´åŒ…å«â€œExpiresâ€å­—æ®µï¼Œå…¶å€¼ä¸ºç¦ç”¨ç¼“å­˜ï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>no-cache</td>
      <td>å¦‚æœå“åº”å¤´åŒ…å«å¸¦æœ‰â€œno-cacheâ€å‚æ•°çš„â€œCache-Controlâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>no-store</td>
      <td>å¦‚æœå“åº”å¤´åŒ…å«å¸¦æœ‰â€œno-storeâ€å‚æ•°çš„â€œCache-Controlâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>private</td>
      <td>å¦‚æœå“åº”å¤´åŒ…å«å¸¦æœ‰â€œprivateâ€å‚æ•°çš„â€œCache-Controlâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>no_last_modified</td>
      <td>å¦‚æœå“åº”å¤´ä¸åŒ…å«â€œLast-Modifiedâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>no_etag</td>
      <td>å¦‚æœå“åº”å¤´ä¸åŒ…å«â€œETagâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>auth</td>
      <td>å¦‚æœè¯·æ±‚æ ‡å¤´åŒ…å«â€œæˆæƒâ€å­—æ®µï¼Œåˆ™å¯ç”¨å‹ç¼©</td>
    </tr>
    <tr>
      <td>any</td>
      <td>ä¸ºæ‰€æœ‰ä»£ç†è¯·æ±‚å¯ç”¨å‹ç¼©</td>
    </tr>
  </tbody>
</table>

<h3 id="8gzip_types">8.gzip_types</h3>

<p>é™¤äº†â€œtext / htmlâ€ä¹‹å¤–ï¼Œè¿˜å…è®¸å¯¹æŒ‡å®šçš„MIMEç±»å‹è¿›è¡Œgzippingå“åº”ã€‚ç‰¹æ®Šå€¼â€œ*â€åŒ¹é…ä»»ä½•MIMEç±»å‹ï¼ˆ0.8.29ï¼‰ã€‚å§‹ç»ˆå‹ç¼©â€œtext / htmlâ€ç±»å‹çš„å“åº”ã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_types</span> <span class="s">mime-type</span> <span class="s">...</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_types</span> <span class="nc">text/html</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h3 id="9gzip_vary">9.gzip_vary</h3>

<p>å¦‚æœæŒ‡ä»¤gzipï¼Œgzip_staticæˆ–gunzipå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œåˆ™å¯ç”¨æˆ–ç¦ç”¨æ’å…¥â€œVaryï¼šAccept-Encodingâ€å“åº”å¤´å­—æ®µã€‚</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">Syntax:</span>	<span class="s">gzip_vary</span> <span class="no">on</span> <span class="s">|</span> <span class="no">off</span><span class="p">;</span>
<span class="k">Default:</span> <span class="s">gzip_vary</span> <span class="no">off</span><span class="p">;</span>
<span class="k">Context:</span> <span class="s">http,</span> <span class="s">server,</span> <span class="s">location</span>
</code></pre></div></div>

<h1 id="4ç¤ºä¾‹é…ç½®">4.ç¤ºä¾‹é…ç½®</h1>

<p>1.å›¾ç‰‡é…ç½®</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(jpg|gif|png)$</span> <span class="p">{</span>
	<span class="kn">root</span>  <span class="n">/opt/app/code/images</span><span class="p">;</span>
	<span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
	<span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
	<span class="kn">gzip_comp_level</span> <span class="mi">2</span><span class="p">;</span>
	<span class="kn">gzip_types</span> <span class="nc">text/plain</span> <span class="nc">application/javascript</span> <span class="nc">application/x-javascript</span> <span class="nc">text/css</span> <span class="nc">application/xml</span> <span class="nc">text/javascript</span> <span class="nc">application/x-httpd-php</span> <span class="nc">image/jpeg</span> <span class="nc">image/gif</span> <span class="nc">image/png</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>2.æ–‡ä»¶ä¸‹è½½</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">.*\.(txt|xml)$</span> <span class="p">{</span>
	<span class="kn">root</span>  <span class="n">/opt/app/code/doc</span><span class="p">;</span>
	<span class="kn">gzip</span> <span class="no">on</span><span class="p">;</span>
	<span class="kn">gzip_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
	<span class="kn">gzip_comp_level</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kn">gzip_types</span> <span class="nc">text/plain</span> <span class="nc">application/javascript</span> <span class="nc">application/x-javascript</span> <span class="nc">text/css</span> <span class="nc">application/xml</span> <span class="nc">text/javascript</span> <span class="nc">application/x-httpd-php</span> <span class="nc">image/jpeg</span> <span class="nc">image/gif</span> <span class="nc">image/png</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>3.é¢„è¯»gzipåŠŸèƒ½</p>
<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="p">~</span> <span class="sr">^/download</span> <span class="p">{</span>
	<span class="kn">root</span> <span class="n">/opt/app/code</span><span class="p">;</span>
	<span class="kn">gzip_static</span> <span class="no">on</span><span class="p">;</span>
	<span class="kn">tcp_nopush</span> <span class="no">on</span><span class="p">;</span>	
<span class="p">}</span>
</code></pre></div></div>

:ET