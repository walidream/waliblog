I"ï<p>ä»¥å‰ä¸Šä¼ å›¾ç‰‡ï¼Œæ–‡ä»¶éœ€è¦å€ŸåŠ©æ’ä»¶ï¼Œä¸å€ŸåŠ©æ’ä»¶æ ¹æœ¬å†™ä¸äº†(ä¸»è¦è¿˜æ˜¯å¤ªèœ)ã€‚ä»Šå¤©å°èœè®°å½•ä¸‹ç”¨<code class="language-plaintext highlighter-rouge">formData</code>APIä¸Šä¼ ï¼Œéå¸¸ç®€å•ã€‚</p>

<h1 id="1ä¸Šä¼ å›¾ç‰‡">1.ä¸Šä¼ å›¾ç‰‡</h1>

<p>è¿™ä¸ªdemoæ˜¯ç”¨jqå†™çš„ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆï¼Œjqè·å–domå¤ªæ–¹ä¾¿äº†ã€‚è¿™ä¸ªä¾‹å­å¯ä»¥ç”¨js,jq,mvvcæ¡†æ¶éƒ½å¯ä»¥.</p>

<blockquote>
  <p>è®°å½•angular 1.6 ç»‘å®šchangæ–¹æ³• <code class="language-plaintext highlighter-rouge">onchange="angular.element(this).scope().uploadPortrait(event)"</code></p>
</blockquote>

<script async="" src="//jsrun.net/VQqKp/embed/all/light/"></script>

<blockquote>
  <p>æ–¹æ³•ï¼š<code class="language-plaintext highlighter-rouge">upLoadImg(event)</code></p>
</blockquote>

<blockquote>
  <p>å‚æ•°ï¼š<code class="language-plaintext highlighter-rouge">event</code></p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>å‚æ•°</th>
      <th>ç±»å‹</th>
      <th>å¿…å¡«</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>event</td>
      <td>Object</td>
      <td>æ˜¯</td>
      <td>äº‹ä»¶å¯¹è±¡</td>
    </tr>
  </tbody>
</table>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">upLoadImg</span><span class="p">(</span><span class="nx">event</span><span class="p">){</span>
    <span class="kd">let</span> <span class="nx">imgInfo</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="c1">//æ•ˆéªŒ</span>
    <span class="c1">//æ ¹æ®imgInfoä¸­name,size,type,lastModifiedDateæ¥æ•ˆéªŒ</span>
	
    <span class="c1">//é¢„è§ˆ</span>
    <span class="kd">let</span> <span class="nx">windowURL</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span> <span class="o">||</span> <span class="nb">window</span><span class="p">.</span><span class="nx">webkitURL</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">imgsrc</span> <span class="o">=</span> <span class="nx">windowURL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">imgInfo</span><span class="p">);</span>  <span class="c1">//è·å–äºŒè¿›åˆ¶è·¯å¾„</span>
	
    <span class="c1">//æ£€æµ‹å›¾ç‰‡å®½ï¼Œé«˜</span>
    <span class="kd">let</span> <span class="nx">_img</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
        <span class="nx">_img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">let</span> <span class="nx">imgW</span> <span class="o">=</span> <span class="nx">_img</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                <span class="nx">imgH</span><span class="o">=</span><span class="nx">_img</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">imgW</span><span class="o">!=</span> <span class="mi">200</span> <span class="o">||</span> <span class="nx">imgH</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">){</span>
               <span class="nx">alert</span><span class="p">(</span><span class="dl">'</span><span class="s1">è¯·ä¸Šä¼ 200px * 200px å›¾ç‰‡</span><span class="dl">'</span><span class="p">);</span>
               <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>			
        <span class="p">};</span>
    <span class="nx">_img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">imgsrc</span><span class="p">;</span>	
	
    <span class="c1">//ä¸Šä¼ </span>
    <span class="kd">let</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>   <span class="c1">//åˆ›å»º FormDataå¯¹è±¡</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">file</span><span class="dl">'</span><span class="p">,</span> <span class="nx">imgInfo</span><span class="p">);</span>  <span class="c1">//æ·»åŠ æ•°æ®</span>
	
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">formData</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
      <span class="c1">//ä¸Šä¼ æˆåŠŸååšæŸäº›äº‹</span>
    <span class="p">});</span>
<span class="p">}</span>

</code></pre></div></div>

<h1 id="2è·å–æœ¬åœ°å›¾ç‰‡base64">2.è·å–æœ¬åœ°å›¾ç‰‡base64</h1>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kd">let</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
   <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">imgInfo</span><span class="p">);</span>
   <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
       <span class="kd">let</span> <span class="nx">imgBase64</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
       <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">imgBase64</span><span class="p">);</span>				
   <span class="p">}</span>
</code></pre></div></div>

<h1 id="3è£å‰ªå›¾åƒ">3.è£å‰ªå›¾åƒ</h1>

<p>canvaså›¾åƒè£å‰ªåœ¨<code class="language-plaintext highlighter-rouge">canvas/å¤´åƒè£å‰ª</code>, å¤´åƒè£å‰ªä¼ é€é—¨<a href="http://waliblog.com/canvas/2018/02/24/portraitNailor.html" title="http://waliblog.com/canvas/2018/02/24/portraitNailor.html">â€œhttp://waliblog.com/canvas/2018/02/24/portraitNailor.htmlâ€</a></p>

:ET